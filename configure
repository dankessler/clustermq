#!/usr/bin/env bash
CXX=$(${R_HOME}/bin/R CMD config CXX)
CXXFLAGS=$(${R_HOME}/bin/R CMD config CXXFLAGS)
CPPFLAGS=$(${R_HOME}/bin/R CMD config CPPFLAGS)

PKG_LIBS=-lunwind

cd src/libzmq
if [ ! -f src/.libs/libzmq.a ]; then
  ./autogen.sh
  CXXFLAGS="$CXXFLAGS -fPIC" ./configure --enable-drafts --disable-libbsd --disable-curve
  make
fi
cd -

sed -e "s|@cflags@|$PKG_CFLAGS|" -e "s|@libs@|$PKG_LIBS|" src/Makevars.in > src/Makevars
